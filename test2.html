<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>webgcode test</title>

    <script src="assets/x3dom.js"></script>
    <script src="assets/jquery.min.js"></script>
    <script src="assets/jquery.flot.min.js"></script>
    <script src="geometry.js"></script>
    <script src="simulation.js"></script>
    <script src="parser.js"></script>
    <style>
        .chart {
            position: relative;
            clear: both;
            width: 100%;
            height: 200px;
        }

        X3D, x3d {
            width: 500px;
            height: 1000px;
        }
    </style>
</head>
<body>
<h1>Testing line raster</h1>

<p>
    lol
</p>
<x3d id="x3d" xmlns="http://www.x3dom.org/x3dom" showStat="false" showLog="false" x="0px" y="0px">
    <Scene id="scene" DEF='scene'>
        <Shape id="xaxis">
            <Appearance>
                <Material emissiveColor='1 0 0'/>
            </Appearance>
            <IndexedLineSet id="lineSet" coordIndex="0 1 -1">
                <Coordinate id="coordinates" point="0.0 0.0 0.0, 10.0 0.0 0.0"/>
            </IndexedLineSet>
        </Shape>
        <transform translation='11 0 0'>
            <Shape>
                <Appearance>
                    <Material emissiveColor='1 0 0'/>
                </Appearance>
                <text string='X' style="BOLD"></text>
            </Shape>
        </transform>
        <Shape id="yaxis">
            <Appearance>
                <Material emissiveColor='0 1 0'/>
            </Appearance>
            <IndexedLineSet id="lineSet" coordIndex="0 1 -1">
                <Coordinate id="coordinates" point="0.0 0.0 0.0, 0.0 10.0 0.0"/>
            </IndexedLineSet>
        </Shape>
        <transform translation='0 11 0'>
            <Shape>
                <Appearance>
                    <Material emissiveColor='0 1 0'/>
                </Appearance>
                <text string='Y' style="BOLD"></text>
            </Shape>
        </transform>
        <Shape id="zaxis">
            <Appearance>
                <Material emissiveColor='0 0 1'/>
            </Appearance>
            <IndexedLineSet id="lineSet" coordIndex="0 1 -1">
                <Coordinate id="coordinates" point="0.0 0.0 0.0, 0.0 0.0 10.0"/>
            </IndexedLineSet>
        </Shape>
        <transform translation='0 0 11'>
            <Shape>
                <Appearance>
                    <Material emissiveColor='0 0 1'/>
                </Appearance>
                <text string='Z' style="BOLD"></text>
            </Shape>
        </transform>
    </Scene>
</x3d>

<script>
    x3dom.runtime.ready = (function () {


        function quadrant(angle) {
            return (Math.floor(angle / (Math.PI / 2) + 0.5) % 4 + 4) % 4;
        }

        var AXES = ['x', 'y', 'z'];
        var testLine = {
            feedRate: 3000,
            from: {x: 0, y: 0, z: 0},
            to: {x: 5, y: 5, z: 5},
            type: "line"};
        var testArc = {
            angularDistance: -Math.PI,
            center: {
                first: 0,
                second: 0
            },
            feedRate: 200,
            from: { x: 0, y: 0, z: 0},
            fromAngle: -Math.PI / 2,
            plane: {
                firstCoord: "x",
                lastCoord: "z",
                secondCoord: "y"
            },
            radius: 6,
            to: {x: 12, y: 0, z: 0},
            type: "arc"
        };
        var stepSize = 0.1;

        function prepare(segment) {
            var group = groupConnectedComponents([segment], 50);
            planSpeed(group[0]);
            return segment;
        }

        path = rasterizeArc(prepare(testArc), stepSize);
        $.each(path, function (idx, point) {
            if (Math.abs(point.dx) > 1 || Math.abs(point.dy) > 1 || Math.abs(point.dz) > 1) {
                console.log('before', path[idx - 1]);
                console.log(point);
            }
        });
        console.log(path.length);
        displayPath(path, '0 0 0', 'toolpath');
        $('#x3d')[0].runtime.showAll();
    });
</script>
</body>
</html>